<!--Add User modal code-->
<div class="container">
  <div class="row">
    <div class="col-xs-12">
      <div class="modal fade" data-backdrop="static" id="addModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Add User</h4>
              <button class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
              <form>
                <script src="https://js.stytch.com/stytch.js"></script>
                <div class="App">
                  <header className="App-header"></header>
                  <div class="Sign-in-container">
                    <div id="magic-link">
                      <div id="advisor-welcome">
                        <h4>Please enter a @uwstout.edu email.</h4>
                      </div>
                    </div>
                  </div>
                </div>
                <script>
                  // Initialize Stytch.js with your public token. You can find this in your Stytch dashboard under API Keys.
                  var STYTCH_PUBLIC_TOKEN = 'public-token-test-98de2089-b8ab-4de1-9ad1-faf94fa77be5';
                  var stytch = Stytch(STYTCH_PUBLIC_TOKEN, {
                    onEvent: (data) => {
                      if (data.eventData.type === 'USER_EVENT_TYPE') {
                        try {
                          fetch('/magic', {
                            method: 'POST',
                            credentials: 'same-origin',
                            body: JSON.stringify({
                              userId: data.eventData.userId,
                              email: data.eventData.email,
                            }),
                            headers: {
                              'Content-Type': 'application/json',
                            },
                          });
                        } catch (e) {
                          console.log(e);
                        }
                      }
                    },
                    onSuccess: (response) => {
                      // Handle a successfully sent magic link
                      document.getElementById('advisor-welcome').style.display = 'none';
                      console.log(response);
                    },
                    onError: (response) => {
                      console.log(response);
                    },
                  });
                  var style = {
                    fontFamily: '"Helvetica New", Helvetica, sans-serif',
                    width: '321px',
                    primaryColor: '#0577CA',
                    hideHeaderText: true,
                  };
                  var magicLinkDefaults = {
                    products: ['emailMagicLinks'],
                    emailMagicLinksOptions: {
                      loginRedirectURL: location.origin + '/authenticate',
                      loginExpirationMinutes: 30,
                      signupRedirectURL: location.origin + '/authenticate',
                      signupExpirationMinutes: 30,
                    },
                  };
                  stytch.mount({
                    elementId: '#magic-link',
                    style: style,
                    loginOrSignupView: magicLinkDefaults,
                  });
                </script>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<% if (messages.success) { %>
  <div class="alert alert-success" role="alert">
    <%- messages.success %>
  </div>
  <% } %>
    <% if (messages.error) { %>
      <div class="alert alert-danger" role="alert">
        <%- messages.error %>
      </div>
      <% } %>

        <div class="card">
          <div class="card-header">
            <ul class="nav nav-pills w-100">
              <li class="nav-pill active">
                <a class="nav-link">Users</a>
              </li>
              <li class="nav-pill ml-auto">
                <a class="btn btn-secondary add" data-toggle="modal" data-target="#addModal" href="/users/addUser">Add
                  User</a>
              </li>
            </ul>
          </div>
          <div class="card-body">
            <% data.sort(function(a, b) { var textA=a.email.toUpperCase(); var textB=b.email.toUpperCase(); return
              (textA < textB) ? -1 : (textA> textB) ? 1 : 0; });
              if(data.length) { %>
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Id</th>
                    <th scope="col">Enabled</th>
                    <th scope="col">Email</th>
                    <th scope="col">Role</th>
                    <th width="200px">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% for(var i=0; i< data.length; i++) { %>
                    <tr>
                      <th scope="row" class="align-middle">
                        <%= data[i].id %>
                      </th>
                      <td class="align-middle">
                        <% if (data[i].enable) { %>
                          <span class="badge badge-success">Active</span>
                          <%} else { %>
                            <span class="badge badge-light">Disabled</span>
                            <% } %>
                      </td>
                      <td class="align-middle">
                        <%= data[i].email%>
                      </td>
                      <td class="align-middle">
                        <%= data[i].role%>
                      </td>
                      <td class="align-middle">
                        <a class="btn btn-secondary edit" href="../users/edit/<%=data[i].id%>">Edit</a>
                        <a class="btn btn-danger delete" onclick="return alert('Are You sure?')"
                          href="../users/delete/<%=data[i].id%>">Delete</a>
                      </td>
                    </tr>
                    <% } %>
                </tbody>
              </table>
              <% } %>

                <!-- if result is empty -->
                <% if(!data.length) { %>
                  <p class="text-center">No Users found!</p>
                  <% } %>
          </div>
          <div>